# Generated by chef for
# server: <%= node[:fqdn] %>
# client: <%= @client[:fqdn] %>

$Conf{ClientNameAlias} = '<%= @client[:ipaddress] %>';

<%- { 'BackupFilesOnly' => :only, 'BackupFilesExclude' => :exclude }.each do |var,key| %>
<%- if @config[:backup_files][key].count > 0 %>
$Conf{<%= var %>} = {
  '*' => [<%= @config[:backup_files][key].map{ |s| "'#{s}'" }.join(', ') %>]
};

<%- end %>
<%- end %>
<%- if @config[:blackout_periods] && @config[:blackout_periods].count > 0 %>
$Conf{BlackoutPeriods} = [
<%- @config[:blackout_periods].each do |period| %>
  {
    'hourBegin' => '<%= period[:begin] %>',
    'hourEnd'   => '<%= period[:end] %>',
    'weekDays'  => [<%= period[:days].join(', ') %>],
  },
<%- end %>
];

<%- end %>
<%- if @config[:rsync] && @config[:rsync][:share_name].count > 0 %>
$Conf{RsyncShareName} = [
<%- @config[:rsync][:share_name].each do |share| %>
  '<%= share %>',
<%- end %>
];
<%- end %>

<%- if @config[:smb] && @config[:smb][:share_name].count > 0 && @config[:smb][:share_user] && @config[:smb][:share_passwd] %>
$Conf{SmbShareName} = [
<%- @config[:smb][:share_name].each do |share| %>
  '<%= share %>',
<%- end %>
];

$Conf{SmbShareUserName} = '<%= @config[:smb][:share_user] %>';
$Conf{SmbSharePasswd} = '<%= @config[:smb][:share_passwd] %>';
$Conf{XferMethod} = 'smb';
<%- end %>

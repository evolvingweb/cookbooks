# Generated by chef for <%= node[:fqdn] %>
# Local modifications will be overwritten
# See the sshd_config(5) manpage for details

Port <%= @config[:port] %>
<% @config[:listen_addresses].each do |addr| -%>
ListenAddress <%= addr %>
<% end -%>

Protocol 2
<% @config[:host_keys].each do |key| -%>
HostKey <%= key %>
<% end -%>
UsePrivilegeSeparation yes

# Lifetime and size of ephemeral version 1 server key
KeyRegenerationInterval 3600
ServerKeyBits 768

# Logging
SyslogFacility AUTH
LogLevel INFO

# Authentication
LoginGraceTime 120
PermitRootLogin <%= @config[:permit_root_login] %>
StrictModes yes

# Client alive
ClientAliveCountMax <%= @config[:client_alive][:count_max] %>
ClientAliveInterval <%= @config[:client_alive][:interval] %>

<% unless @config[:deny_users].empty? -%>
DenyUsers <%= @config[:deny_users].join(' ') %>

<% end -%>
<% unless @config[:allow_users].empty? -%>
AllowUsers <%= @config[:allow_users].join(' ') %>

<% end -%>
<% unless @config[:deny_groups].empty? -%>
DenyGroups <%= @config[:deny_groups].join(' ') %>

<% end -%>
<% unless @config[:allow_groups].empty? -%>
AllowGroups <%= @config[:allow_groups].join(' ') %>

<% end -%>
# pubkey authentication
RSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile .ssh/authorized_keys

IgnoreRhosts yes
RhostsRSAAuthentication no
HostbasedAuthentication no
IgnoreUserKnownHosts no

PermitEmptyPasswords no
ChallengeResponseAuthentication no
PasswordAuthentication <%= @config[:password_logins] ? 'yes' : 'no' %>

X11Forwarding yes
X11DisplayOffset 10
PrintMotd no
PrintLastLog yes
TCPKeepAlive yes

AcceptEnv LANG LC_*

Subsystem sftp /usr/lib/openssh/sftp-server

UsePAM yes
